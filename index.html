
<!DOCTYPE html>
<meta charset="utf-8">
<html>

<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>Stephen Curry's Shot Efficiency 22-23</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="style.css" />
	<style>
		#scrolly {
			position: relative;
			display: -webkit-box;
			display: -ms-flexbox;
			display: flex;
			background-color: #f3f3f3;
			padding: 1rem;
		}

		#scrolly>* {
			-webkit-box-flex: 1;
			-ms-flex: 1;
			flex: 1;
		}

		article {
			position: relative;
			padding: 0 1rem;
			max-width: 40rem;
		}

		figure {
			position: -webkit-sticky;
			position: sticky;
			width: 100%;
			margin: 0;
			-webkit-transform: translate3d(0, 0, 0);
			-moz-transform: translate3d(0, 0, 0);
			transform: translate3d(0, 0, 0);
			z-index: 0;
		}

		figure p {
			text-align: left;
			padding: 1rem;
			position: absolute;
			font-size: 2rem;
			color: #000000;
			top:50%;
		}

		.step {
			margin: 0 auto 2rem auto;
			background-color: #efefef;
			color: #fff;
		}

		.step:last-child {
			margin-bottom: 0;
		}

		.step.is-active {
			background-color: #e0dfdf;
			color: #3b3b3b;
		}

		.step p {
			text-align: center;
			padding: 1rem;
			font-size: 1.5rem;
		}


		.svg-style {
        background-color: lightblue;
        display: block;
        margin: auto;

           }
	</style>
</head>

<body>
	<a href="https://github.com/jaromc" target="_blank" class="github-corner"
		aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250"
			style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
			<path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
			<path
				d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
				fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
			<path
				d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
				fill="currentColor" class="octo-body"></path>
		</svg></a>
	<main>
		<nav>
			<a href="https://www.nba.com/stats">NBA Stats</a>
			<div class="nav__examples">
				<p>github:</p>
				<a href="https://github.com/jaromc">jaromc</a>
			</div>
		</nav>
		<section id="intro">
			<h1 class="intro__hed">Stephen Curry's Shot Efficiency 22-23</h1>
			<p class="intro__dek">
				Scroll to begin the analysis.
			</p>
		</section>

		<section id="scrolly">
			<article>
				<div class="step" id="step1" data-step="1">
					<p id="p1"></p>
					<p id="p2"></p>
				</div>
				<div class="step" id="step2" data-step="2">
					<p id="p1">STEP 2</p>
					<p id="p2">STEP 1</p>
				</div>
				<div class="step" id="step3" data-step="3">
					<p id="p1">STEP 3</p>
					<p id="p2">STEP 1</p>
				</div>
				<div class="step" id="step4" data-step="4">
					<p id="p1">STEP 4</p>
					<p id="p2">STEP 1</p>
				</div>
				<div class="step" id="step5" data-step="5">
					<p id="p1">STEP 5</p>
					<p id="p2">STEP 1</p>
				</div>
				<div class="step" id="step6" data-step="6">
					<p id="p1">STEP 5</p>
					<p id="p2">STEP 1</p>
				</div>
				<div class="step" id="step7" data-step="7">
					<p id="p1">STEP 5</p>
					<p id="p2">STEP 1</p>
				</div>
			</article>

         <figure>
				<div class="my_dataviz">
               <p></p>
            </div>
			</figure>

		</section>

		<section id="outro"></section>
	</main>

	<!-- <div class='debug'></div> -->
   <!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
	<script src="https://unpkg.com/scrollama"></script>
	<script>

function load_data(filtered_data_function, shot_efficiency_function, zone, step_elm) {
         // append the svg object to the body of the page
         var main = d3.select("main");
         var figure = scrolly.select("figure");
         var my_dataviz = figure.select(".my_dataviz");

         my_dataviz.select("svg").remove();


            // set the dimensions and margins of the graph
           var margin = {top: 10, right: 10, bottom: 20, left: 30},
          width = 600;
          height = 700;
			 legend_spacing = 100;

         var svg = my_dataviz
        .append("svg")
          .attr("width", width + margin.left + margin.right + legend_spacing)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")")
			.attr("class", "svg-style");

      // Parse the Data
      d3.csv("player_shot_data.csv", function(data) {

			filtered_data = data.filter(filtered_data_function);

			var cleaned_data = filtered_data.map(function(d) {
			return {
				LOC_X: d.LOC_X,
				LOC_Y: d.LOC_Y,
				SHOT_ZONE_BASIC: d.SHOT_ZONE_BASIC,
				EVENT_TYPE: d.EVENT_TYPE,
				SHOT_ATTEMPTED_FLAG : d.SHOT_ATTEMPTED_FLAG
			}
			});

			shot_efficiency_function(filtered_data, step_elm, zone);

			var x = d3.scaleLinear()
			.domain([-250, 250])
			.range([ margin.left, width - margin.right]);

      // Add Y axis
      var y = d3.scaleLinear()
         .domain([-50, 600])
         .range([height - margin.bottom, margin.top]);

      // Add dots
      svg.append('g')
         .selectAll("dot")
         .data(cleaned_data)
         .enter()
         .append("circle")
            .attr("cx", function (d) { return x(d.LOC_X); } )
            .attr("cy", function (d) { return y(d.LOC_Y); } )
            .attr("r", 3)
            .style("fill", function (d) { return d.EVENT_TYPE == "Made Shot" ? "#69b3a2" : "#EA0B00"; })
				.style("opacity", 0)

				svg.selectAll("circle")
				.transition()
				.delay(function(d,i){return(i)})
				.duration(1000)
				.style("opacity", 1)


				const lines = [
    [-250, 420, 250, 420], // half
    [-250, 420, -250, -50], // left
    [250, 420, 250, -50], // right
    [250, -50, -250, -50], // bottom
    [-220, -50, -220, 90], // corner 3
    [220, -50, 220, 90], // corner 3
    [-80, -50, -80, 140], // paint
    [80, -50, 80, 140], // paint
    [-80, 140, 80, 140], // free throw line
    [-30, -10, 30, -10], // backboard
    [0, -10, 0, -7.5], // rim
    [-40, -10, -40, 0], // ra
    [40, -10, 40, 0] // ra
  ];

  const circles = [
    [0, 0, 7.5],  // rim
    [0, 140, 60],  // key
    [0, 420, 20],  // center court inner
    [0, 420, 60]  // center court outer
  ];

	let angle = Math.atan(90/220);
	const arcs = [
	[0, 0, 40, -Math.PI*0.5, Math.PI*0.5],                    // ra
      [0, -8, 237.5, -Math.PI*0.5+angle, Math.PI*0.5  - angle],  // 3pt
  ];

  svg.append('g').selectAll("lines")
		.data(lines)
		.enter().append("line")
    .style("stroke", "black")
    .style("stroke-width", 2)
    .attr("x1", function(d){return(x(d[0]))})
    .attr("y1", function(d){return(y(d[1]))})
    .attr("x2", function(d){return(x(d[2]))})
    .attr("y2", function(d){return(y(d[3]))});

	 svg.append('g').selectAll("ellipse")
		.data(circles)
		.enter().append("ellipse")
    .style("stroke", "black")
    .style("stroke-width", 2)
	 .style("fill", "none")
    .attr("cx", function(d){return(x(d[0]))})
    .attr("cy", function(d){return(y(d[1]))})
    .attr("rx", function(d){return(Math.abs(x(d[2]) - x(0)))})
    .attr("ry", function(d){return(Math.abs(y(d[2]) - y(0)))});

	 svg.append('g').selectAll("paths").data(arcs)
	 .enter().append("path")
	 .style("stroke", "black")
    .style("stroke-width", 2)
    .attr("transform", d => `translate(${ x(d[0]) }, ${ y(d[1]) })`)
    .attr("d", d3.arc()
		.innerRadius(d => Math.abs(x(d[2]) - x(0)))
		.outerRadius(d => Math.abs(x(d[2]) - x(0)))
		.startAngle(d => d[3])
		.endAngle(d => d[4]));


		svg.append("circle").attr("cx",width + 10).attr("cy",230).attr("r", 6).style("fill", "#69b3a2")
		svg.append("circle").attr("cx",width + 10).attr("cy",260).attr("r", 6).style("fill", "#EA0B00")
		svg.append("text").attr("x", width + 30).attr("y", 230).text("Made Shot").style("font-size", "15px").attr("alignment-baseline","middle")
		svg.append("text").attr("x", width + 30).attr("y", 260).text("Missed Shot").style("font-size", "15px").attr("alignment-baseline","middle")
      })
}

		// using d3 for convenience
		var main = d3.select("main");
		var scrolly = main.select("#scrolly");
		var figure = scrolly.select("figure");
		var article = scrolly.select("article");
		var step = article.selectAll(".step");


		// initialize the scrollama
		var scroller = scrollama();

		// generic window resize listener event
		function handleResize() {
			// 1. update height of step elements
			var stepH = Math.floor(window.innerHeight * 0.7);
			step.style("height", stepH + "px");

			var figureHeight = window.innerHeight / 2;
			var figureMarginTop = (window.innerHeight - figureHeight) / 2;

			figure
				.style("height", figureHeight + "px")
				.style("top", figureMarginTop + "px");

			// 3. tell scrollama to update new element dimensions
			scroller.resize();
		}

			//points scored per shot attempt
			const shot_efficiency = function(data, step_elm, zone) {
				const total_scored = d3.sum(data.filter(d => d.EVENT_TYPE == "Made Shot"), d => d.SHOT_TYPE == "2PT Field Goal" ? 2 : 3);
				//redundant, every row is an attempt
				const total_attempts = d3.sum(data, d => d.SHOT_ATTEMPTED_FLAG);
				curry_eff = (total_scored / total_attempts).toString();
				step_elm.text("Stephens' efficiency from " + zone + " is '" + d3.format(".4")(curry_eff) + "'");
			};

			const team_shot_efficiency = function(data, step_elm) {
				const total_scored = d3.sum(data.filter(d => d.EVENT_TYPE == "Made Shot"), d => d.SHOT_TYPE == "2PT Field Goal" ? 2 : 3);
				//redundant, every row is an attempt
				const total_attempts = d3.sum(data, d => d.SHOT_ATTEMPTED_FLAG);
				team_eff = (total_scored / total_attempts).toString();
				step_elm.text("His team's average was '" + d3.format(".4")(team_eff) + "'");
			};


		// scrollama event handlers
		function handleStepEnter(response) {

			figure.select("p").text("");
			step.select("#p1").text("");
			step.select("#p2").text("");

			const team_csv_filename = "team_shot_data.csv";

			switch(response.index) {
				case 0:
				{
						figure.select("p").text("Here you'll see Stephen Curry's shot efficiency from each zone. \
							All attempted shots from 22-23 season.\n\
							To the left we compare his performance to his team's average. A higher number is better.");
						var my_dataviz = figure.select(".my_dataviz");
         			my_dataviz.select("svg").remove();
					break;
				}
				case 1:
				{
					const nameLambda = function(row) {
						return row['SHOT_ZONE_BASIC'] == 'Right Corner 3' ||
						row['SHOT_ZONE_BASIC'] == 'Left Corner 3';
					};
					
					load_data(nameLambda, shot_efficiency, 'Corner 3', article.select("#step2").select("#p1"));

					d3.csv(team_csv_filename, function(data) {
						filtered_data = data.filter(nameLambda);
						team_shot_efficiency(filtered_data, article.select("#step2").select("#p2"));
					});

					break;
				}
				case 2:
				{
					const nameLambda = function(row) {
						return row['SHOT_ZONE_BASIC'] == 'Above the Break 3';
					};
					load_data(nameLambda, shot_efficiency, 'Above the Break 3', article.select("#step3").select("#p1"));

					d3.csv(team_csv_filename, function(data) {
						filtered_data = data.filter(nameLambda);
						team_shot_efficiency(filtered_data, article.select("#step3").select("#p2"));
					});

					break;
				}
				case 3:
				{
					const nameLambda = function(row) {
						return row['SHOT_ZONE_BASIC'] == 'Mid-Range';
					};
					load_data(nameLambda, shot_efficiency, 'Mid-Range', article.select("#step4").select("#p1"));

					d3.csv(team_csv_filename, function(data) {
						filtered_data = data.filter(nameLambda);
						team_shot_efficiency(filtered_data, article.select("#step4").select("#p2"));
					});

					break;
				}
				case 4:
				{
					const nameLambda = function(row) {
						return row['SHOT_ZONE_BASIC'] == 'In The Paint (Non-RA)';
					};
					load_data(nameLambda, shot_efficiency, 'In The Paint (Non-RA)', article.select("#step5").select("#p1"));

					d3.csv(team_csv_filename, function(data) {
						filtered_data = data.filter(nameLambda);
						team_shot_efficiency(filtered_data, article.select("#step5").select("#p2"));
					});

					break;
				}
				case 5:
				{
					const nameLambda = function(row) {
						return row['SHOT_ZONE_BASIC'] == 'Restricted Area';
					};

					figure.select("p").text("");

					load_data(nameLambda, shot_efficiency, 'Restricted Area', article.select("#step6").select("#p1"));

					d3.csv(team_csv_filename, function(data) {
						filtered_data = data.filter(nameLambda);
						team_shot_efficiency(filtered_data, article.select("#step6").select("#p2"));
					});

					break;
				}
				case 6:
				{
						figure.select("p").style("text-align", "center")
						var my_dataviz = figure.select(".my_dataviz");
         			my_dataviz.select("svg").remove();

						figure.select("p").text("We can see that Stephen's shot efficiency was better than his \
							teams average from all court zones in this season.");
					break;
				}
			}

			// add color to current step only
			step.classed("is-active", function (d, i) {
				return i === response.index;
			});
		}

		function handleStepProgress(response) {
			console.log(response.progress)
			var el = d3.select(response.element);
			var val = el.attr("data-step");
			console.log(val)
			if (val == 1) {
				figure.select("p").style("opacity", 1.0 - response.progress);
			}
			else if (val == 7) {
				figure.select("p").style("opacity", response.progress);
			}
			else
			{
				figure.select("p").style("opacity", 0.0);
			}
		}


		function init() {

			// 1. force a resize on load to ensure proper dimensions are sent to scrollama
			handleResize();

			// 2. setup the scroller passing options
			// 		this will also initialize trigger observations
			// 3. bind scrollama event handlers (this can be chained like below)
			scroller
				.setup({
					step: "#scrolly article .step",
					progress: true,
					offset: 0.5,
					debug: false
				})
				.onStepEnter(handleStepEnter)
				.onStepProgress(handleStepProgress);
		}

		// kick things off
		init();
	</script>
</body>

</html>
